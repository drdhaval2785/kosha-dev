# Understand what is happenning

I would try to understand the changes which are happenning to a dictionary from the file anhk1.txt to the harsa.txt, harsa.xml and harsa.sqlite. 
I have a flimsy knowledge of how this pipeline works in other Cologne dictionaries. I will explore and document step by step what is the input, what is the output and what is the script. This will help me get a better hang of what to do to minimize the duplication in every possible manner.

# Input file - anhk1.txt

This file is annotated version of anekārthanāmamālā of Harśakīrti. https://github.com/sanskrit-lexicon/COLOGNE/issues/405#issuecomment-1471292298 

Format
```
<L>1<pc>140
<k1>क-पुं<meanings>सूर्य,वेधस्
<k1>क-क्ली<meanings>सुख,मस्तक,जल
<k1>श्लोक-पुं<meanings>अनुष्टुभ्,यशस्
<k1>लोक-पुं<meanings>भुवन,जन
सूर्ये वेधसि वायौ कः कं सुखे मस्तके जले ।
अनुष्टुब्यशसोः श्लोको लोकस्तु भुवने जने ॥ १ ॥
<LEND>
```

# harsa.txt

This file is SLP1 version of ankh1.txt
This is generated by prep/harsa/redo.sh file.
Workhorse is prep/harsa/convert.py file.

Format
```
<L>1<pc>140
<k1>ka-puM<meanings>sUrya,veDas
<k1>ka-klI<meanings>suKa,mastaka,jala
<k1>Sloka-puM<meanings>anuzwuB,yaSas
<k1>loka-puM<meanings>Buvana,jana
sUrye veDasi vAyO kaH kaM suKe mastake jale .
anuzwubyaSasoH Sloko lokastu Buvane jane .. 1 ..
<LEND>
```

# harsa.txt to csl-orig

csl-orig is the place where Cologne stores its dictionary data.

# Generate local displays

```sh
cd csl-pywork
sh generate_dict.sh harsa  ../apps/harsa
```

This code does three things.
1. Generate the local copies of orig / pywork / websanlexicon in `apps/harsa` directory.
2. Regenerate the headword details in pywork directory by running `redo_hw.sh`
3. Regenerate the XML details in pywork directory by running `redo_xml.sh`

They require further examination.

The log generated in the process is quite helpful to understand what is happenning under the hood.

```
[create@dhaval-pc csl-pywork]$ sh generate_dict.sh harsa  ../apps/harsa
BEGIN generate_orig.sh harsa ../apps/harsa
END generate_orig.sh harsa ../apps/harsa

BEGIN generate_pywork.sh harsa ../apps/harsa
END generate_pywork.sh harsa ../apps/harsa

BEGIN generate_web.sh harsa ../apps/harsa
generate web code for dictionary harsa to /home/create/Documents/projects/drdhaval2785/kosha-dev/v1/apps/harsa
END generate_web.sh harsa ../apps/harsa


*****************************************************
BEGIN execution of pywork code at ../apps/harsa/pywork
BEGIN redo_hw.sh
construct xxxhw.txt
BEGIN hw.py
BEGIN hw.py init_entries
934 lines read from ../orig/harsa.txt
112 entries found
END hw.py init_entries

BEGIN write_entries
1260 lines written to harsahw.txt
END write_entries
END hy.py

BEGIN hw2.py
END hw2.py
BEGIN hw0.py
END hw0.py
END  redo_hw.sh
regenerate harsa.xml and postxml files
BEGIN redo_xml.sh
construct harsa.xml...
make_xml.py BEGINS !!!!!
All records parsed by ET
\nxmllint on harsa.xml...
SKIPPING xmllint validity check
\nharsa.sqlite...
BEGIN pywork/redo_postxml.sh
/home/create/Documents/projects/drdhaval2785/kosha-dev/v1/apps/harsa/pywork
cp harsaheader.xml ../web/

BEGIN sqlite
remaking harsa.sqlite from ../harsa.xml with python...
sqlite.py: dictionary code= harsa
create_index takes 0.13 seconds
1265 lines read from ../harsa.xml
1260 rows written to harsa.sqlite
0.42 seconds for batch size 10000
moving harsa.sqlite to web/sqlite/
END sqlite
1260 records read from ../harsa.xml
1256 records written to query_dump.txt
END redo_xml.sh

generate_dict.sh:  NOT preparing downloads
/home/create/Documents/projects/drdhaval2785/kosha-dev/v1/apps/harsa/pywork
```



